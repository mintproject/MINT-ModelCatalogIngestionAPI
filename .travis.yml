language: generic
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.23.2
  global:
  - secure: Ez+j801zKRCLD+jqb4WmkFWdiOsBSf/afKdGr01kVDNK5dGvPvIHN6CAcC6A4R5GqhoQI5B0mM8bYe1Cc+BvtpVWdU9iwHSZKGs9C0XUS+dCkIm3kwx7FFT68Aof491zEVhS6b8DTK1jKLuC7uEl244W3mQIgOUdzMnihRmHpV4aNanHDJx3mk/z8lIb2MJf4o+GhhWHlnlpyBwb9jf1XNuFujIxHLBBP3NvNqYa1LgHsCUvvpXd9ezozHve0nhMLne9c3yKEOO2kawaMnYSC+I6l+DBREIycalMLgC81wfNkeRRueYIdbRcTbD6kIQ1WvtuD71wo9beO084EEN3XNJcffnNWdSKLAzuTeNE3dskSRz+tlO+u6ZMHMBqD98CoM3kyzsk9Gz0S4MgEi6s85rQ69DTU21dzKi0b4hYR6Vi+xXksDueIvKqXHpIikkOnK+Hg0JbPDBk4I/R1CzX7lfmWaQZBH4HTCT0n8obTBW2Ya7ZTA20g1ZXUPZb8lz528qAcHssd2gaJEeHgFoKtmQx3er9c2B+NBS4Q36ampOnGQF5O6xWDbW1JwLfms0UkGxqBECIKXy8Rb6xuN7KRbQXbqLayOfu7voS6YNQzJ3VSWvFClXXyLMvzaFbl1RfbgwHRBF+2n9EcJt1zFujk3r3YWUXTFl2Wfs0TbJw78Y=
  - secure: fiEgERsrrw0QWuSHIDQNegu5reFDIaSAACO1fOzwEjlQ92//rEVcIwB8Ez1TJ2V3PQXzezwGTQCpO4GTyaiEWCIfIVp3fn1jSlwiPNbzWj58QebF052py54Ank064LCgB0HS7edGcvzwBpV1DP3hcmadAxHpWSrZrIFxyUSVwX5sME/s2uHhLby2U+DrRVaffvX45HhXJ+uLiyLL1IPyFoRbN91oLmNsncTaRpV58nac+HiZoO+vGLrWm++8D+ATgFz0iJO5X9g+ilxzZFojLYbqK6M3DfMTL+6p7HmJG0ywUcl3qpMe2fwsyjToM3ojNMf3tR9Vb7R/GUv64x1lGrt+6rNTXYeZawiARsFMHkxZmPX1X5jtsUfMz6DpF7M3a7hTiDyAoQM13SXxpKFy6EsmWu3DEZR+rVtxR0Jj602uqfWmQyh0etYqfdkWzPn0y2/VYBmzguSlRHXsL13rwPvpPPqkEdLe/RkXxh67G/t33QFNA7VcIW/AoqYGwUDd4hKTe06Ukng5RVDv6hYH6ZwDjeWyateBSkXzeawZW41GaAssjbBC/uxUJ+6G7CSvaeKXlMN4AH5UKyuJ6AAl4rRhgXu27JKcngRgvuw5NK/Ji5nn71PLYwm+RsOwIpq3bJrqOSPN+/b+H4ZZg3F5o28+zXF0PaCQIQ49GeYUpxY=
services:
- docker
before_install:
- curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
- sudo apt-get install nodejs
- npm install --global release-it
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- pushd server
- docker build -t model-catalog-api .
- docker tag model-catalog-api mintproject/model-catalog-api:latest
- docker push mintproject/model-catalog-api:latest
- popd
deploy:
  provider: script
  script: bash .deploy
  on:
    tags: true
    all_branches: true
  skip_cleanup: true

